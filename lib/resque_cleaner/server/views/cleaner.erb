<link href="cleaner/public/cleaner.css" media="screen" rel="stylesheet" type="text/css">

<div class="cleaner">
  <div class="title clearfix">
    <h1>Group by class</h1>
  </div>

  <button id="cleanup">Clean Up</button>

  <%= erb(
        File.read(ResqueCleaner::Server.erb_path("_stats.erb")),
        locals: {q: 'c', type: 'klass'}
      ) %>

  <div class="title clearfix">
    <h1>Group by exception</h1>
  </div>

  <%= erb(
        File.read(ResqueCleaner::Server.erb_path("_stats.erb")),
        locals: {q: 'ex', type: 'exception'}
      ) %>

  <div class="title clearfix">
    <h1>Group by queue</h1>
  </div>

  <%= erb(
        File.read(ResqueCleaner::Server.erb_path("_stats.erb")),
        locals: {q: 'q', type: 'queue'}
      ) %>

  <% if @cleaner.limiter.on? %>
    <%= erb File.read(ResqueCleaner::Server.erb_path("_limiter.erb")) %>
  <% end %>
</div>

<script>
  $(document).ready(function(){
    $('#cleanup').click(function(){
      $.ajax({
        url: 'crimson_cleanup',
        success: function(data) {
          alert('Number of jobs requeued: ' + JSON.parse(data).requeued);
          location.reload;
        }
      });
    });
  });
</script>
